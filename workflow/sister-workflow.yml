cwlVersion: v1.0
class: Workflow
inputs:
  workflow_context: File
  step_1_key: string
  step_2_key: string
  step_3_key: string
  step_4_key: string
  pge_prep_filepath: string
  run_pge_filepath: string
  post_pge_filepath: string
  input_context: File[]?

outputs:
  output_context:
    type: File[]
    outputSource: l2_reflectance_correction-workflow/context

requirements:
  SubworkflowFeatureRequirement: {}
  MultipleInputFeatureRequirement: {}

steps:
  l1_preprocess-workflow:
    run: pge-workflow.yml
    in:
      pge_prep_filepath: pge_prep_filepath
      workflow_context: workflow_context
      step_key: step_1_key
      input_context: input_context
      run_pge_filepath: run_pge_filepath
      post_pge_filepath: post_pge_filepath
    out: [context]

  l2_reflectance-workflow:
    run: pge-workflow.yml
    in:
      pge_prep_filepath: pge_prep_filepath
      workflow_context: workflow_context
      step_key: step_2_key
      run_pge_filepath: run_pge_filepath
      post_pge_filepath: post_pge_filepath
      input_context:
        source: [l1_preprocess-workflow/context]
    out: [context]

  l2_resample-workflow:
    run: pge-workflow.yml
    in:
      pge_prep_filepath: pge_prep_filepath
      workflow_context: workflow_context
      step_key: step_3_key
      run_pge_filepath: run_pge_filepath
      post_pge_filepath: post_pge_filepath
      input_context:
        source: [l2_reflectance-workflow/context]
    out: [ context ]

  l2_reflectance_correction-workflow:
    run: pge-workflow.yml
    in:
      pge_prep_filepath: pge_prep_filepath
      workflow_context: workflow_context
      step_key: step_4_key
      run_pge_filepath: run_pge_filepath
      post_pge_filepath: post_pge_filepath
      input_context:
        source: [l2_resample-workflow/context, l1_preprocess-workflow/context]
        linkMerge: merge_flattened
    out: [ context ]
